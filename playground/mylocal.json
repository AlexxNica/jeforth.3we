{
	"ad": "\t\\ Remove all annoying floating ad boxes. 刪除所有惱人的懸浮框。\n\tactive-tab :> id tabid! \n\tvar divs = document.getElementsByTagName(\"div\");\n\tfor (var i=divs.length-1; i>=0; i--){\n\t  if(divs[i].style.position){\n\t\tdivs[i].parentNode.removeChild(divs[i]);\n\t  }\n\t}\n\tfor (var i=divs.length-1; i>=0; i--){\n\t  if(parseInt(divs[i].style.width)<600){ // <---- 任意修改\n\t\tdivs[i].parentNode.removeChild(divs[i]);\n\t  }\n\t}\n\t\n",
	"autoexec": "js: outputbox.style.fontSize=\"1.5em\"\ncr .\" Local jeforth.3ce host page \" cr",
	"company-hash": "{\"01002T國泰R1\":true,\"01003T新光R1\":true,\"1473台南\":true,\"2201裕隆\":true,\"2204中華\":true,\"2641正德\":true,\"3224三顧\":true,\"4420光明\":true,\"5011久陽\":true}",
	"pruning": "\t\\ Make the target page editable for pruning. 把 target page 搞成 editable 以便修剪。\n\tactive-tab :> id tabid!  document.getElementsByTagName(\"body\")[0].contentEditable=true \n",
	"sourcecode": "\\ \n\\ jeforth.3ce 讀取「臺灣銀行」的「除權除息表」並比對歷史，如果有新的就發出 alert。\n\\ 應用 localStorage 貯存公司列表，所以關機重跑還是記得讀到過的公司。\n\\\n\\ 要手動先準備的部分\n\\ 1. open the data page \n\\    > js: window.open(\"http://fund.bot.com.tw/z/ze/zeb/zeba.djhtm\")\n\\ 2. open 3ce page\n\\ 3. Assign tabid\n\\    > list-tabs \\ get tabid\n\\      228 除權除息表-依股號\n\\    > 228 tabid! \\ setup tabid \n\t  \n\t: dump-all-  ( -- ) \\ Dump all  table cells of tabid target page\n\t  js> $(\"td\").length ( length )\n\t  ?dup if dup for dup r@ - ( COUNT i ) \n\t\t >r\n\t\t js> $(\"td\")[rtos()].innerText \\ cell value\n\t\t js> $(\"td\")[rtos()].getAttribute(\"class\") dup if char _note_ + then\n\t\t js> $(\"td\")[rtos()].id dup if char _note_ + then\n\t\t r>\n\t\t .\" index:\" . .\"  ID: \" . .\"  Class: \" . space . cr \\ the cr provides an important nap time \n\t  ( COUNT ) next drop then ; \n\t  /// Run on jeforth.3ce target page\n\n\t: dump-all-  ( -- ) \\ Dump all  table rows of tabid target page\n\t  js> $(\"tr\").length ( length )\n\t  ?dup if dup for dup r@ - ( COUNT i ) \n\t\t >r\n\t\t js> $(\"tr\")[rtos()].outerHTML remove-script-from-HTML  remove-select-from-HTML \\ row HTML\n\t\t js> $(\"tr\")[rtos()].getAttribute(\"class\") dup if char _note_ + then\n\t\t js> $(\"tr\")[rtos()].id dup if char _note_ + then\n\t\t r>\n\t\t .\" index:\" . .\"  ID: \" . .\"  Class: \" . space  drop cr \\ the cr provides an important nap time \n\t  ( COUNT ) next drop then ; \n\t  /// Run on jeforth.3ce target page\n\t\n    : Refresh_the_target_page ( -- ) \\ Refresh the tabid target page.\n        tabid js: chrome.tabs.reload(pop())\n        500 nap tabid tabs.get :> status!=\"complete\" if\n            1500 nap \\ Do my best to allow the title to become available\n            .\" Still loading \" tabid tabs.get :> title . space\n            0 begin\n                tabid tabs.get :> status==\"complete\" if 1+ then\n                dup 5 > if ( TOS 餵給 until ) else \\ 5 complete to make sure it's very ready.\n                    char . . 300 nap false\n                then\n            until .\"  done! \" cr\n        then ;\n        /// Improve this if the target page is unstable then we need to timeout and retry.\n\n    : find-next-company ( i -- i' ) \\ Find next 已公布除權息日的公司 in 台銀除權除息表 return index or zero.\n        s\" var last_index = \" swap + [compile]  \\ setup variable for the target page\n        \n        var next_index = 0;\n        var array_td = document.getElementsByTagName(\"td\");\n        for (var i=last_index+1; i :> [0] ;\n\n    : company-name ( i -- name ) \\ Convert index of  to company name\n         var array_td = document.getElementsByTagName(\"td\"); \n        char array_td[ swap + char ].innerText + \n        [compile]  :> [0] ;\n\n    : get-company-hash ( -- hash count ) \\ Get the company names of 台銀除權除息表。\n         var array_td = document.getElementsByTagName(\"td\");\n        {} ( hash ) 0 ( count ) 0 ( index ) begin \n            find-next-company dup ( hash count idx' idx' ) \n        while \n            ( hash count idx' ) swap 1+ swap ( hash count++ idx' )\n            dup company-name ( hash count++ idx' name )\n            js: tos(3)[pop()]=true ( hash count++ idx' )\n        repeat   ( hash count++ 0 ) drop ;\n\n    : save-company-hash ( hash -- ) \\ Save company hash to local storage key 'company-hash'.\n        js> JSON.stringify(pop()) ( json )\n        js: localStorage[\"company-hash\"]=pop() ;\n        /// localStorage[\"company-hash\"] is JSON\n\n    : restore-company-hash ( -- hash ) \\ Read company hash from local storage key 'company-hash'.\n        js> localStorage[\"company-hash\"] \n        js> tos()==undefined if null else js> JSON.parse(pop()) then ;\n        /// localStorage[\"company-hash\"] is JSON\n\n    : isSameHash ( h1 h2 -- boolean ) \\ Compare two hash table\n         \n        var flag = true;\n        for (var i in tos(1)){ // 兩頭各比一次\n            if (tos()[i]!==true) flag = false;\n            break;\n        }; \n        for (var i in tos()){ // 兩頭各比一次\n            if (tos(1)[i]!==true) flag = false;\n            break;\n        }; execute(\"2drop\"); flag  ;\n\n    : check_updated ( -- ) \\ Check if 台銀除權除息表 is updated\n        restore-company-hash ( hash0 ) obj>keys :> length if \\ Init check\n            now t.dateTime . .\"  localStorage company hash = \" restore-company-hash dup (see)\n            get-company-hash drop dup -rot isSameHash if ( company-hash )\n                drop .\" , no update since the last check.\" cr\n            else  ( company-hash )\n                s\" , something new updated. Check it out!\" \n                dup . cr js: alert(pop())\n                dup (see) save-company-hash\n            then\n        else \n            \\ initialize\n            get-company-hash drop save-company-hash\n        then ;\n\n\\ Check every hour\n\n    \\ run: begin Refresh_the_target_page check_updated 1000 60 * 60 * nap again\n\n\n\n\t\\ Obloleted words\n\t\n    : count_oAddCheckbox ( -- n ) \\ Get the company count of 台銀除權除息表。\n        0 ( count ) 0 ( index ) begin \n            find-next-company dup ( count idx' idx' ) \n        while \n            ( count idx' ) swap 1+ swap \n        repeat  ( count 0 ) drop ;\n        /// Item count does not mean much, because the table cuts items \n        /// before yesterday.\n\n    : check_oAddCheckbox_count ( -- ) \\ Check if 台銀除權除息表 is updated <== obsoleted\n        js> localStorage.oAddCheckbox_count ( init check ) if\n            now t.dateTime . .\"  localStorage.oAddCheckbox_count = \" js> localStorage.oAddCheckbox_count .\n            count_oAddCheckbox js> localStorage.oAddCheckbox_count int = if\n                .\" , no update since the last check.\" cr\n            else\n                s\" , something new updated. Check it out!\" \n                dup . cr js: alert(pop())\n                count_oAddCheckbox js: localStorage.oAddCheckbox_count=pop()\n            then\n        else \n            \\ initialize\n            count_oAddCheckbox\n            js: localStorage.oAddCheckbox_count=tos()\n            js> localStorage.oAddCheckbox_count!=pop() if\n                s\" Error! Your browser does not support HTML5 localStorage.\" \n                dup . cr \"msg\"abort\n            then\n        then ;\n\n\n"
}