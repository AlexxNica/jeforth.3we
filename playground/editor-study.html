<style id="mystyle" type="text/css">
				
				.default { 
					
					
					
					
					font-family: Microsoft JhengHei;  
					letter-spacing: 0px;
					line-height: 160%;
					tab-size:4; 
				}
				
				code { 
					font-family: courier new;
					font-size: 120%; 
					background: #E0E0E0; 
				}
				
				.commandline { 
					width: 90%;
					background: #E0E0E0; 
				}
				.source {  
					font-size: 100%;   
					line-height: 100%; 
				}
			</style><div class="default" id="myarticle" contentEditable="true"><blockquote>

			
			<h1>用 jeforth 在網頁上直接編輯 HTML 文章</h1>

			<img src="doc/editor.png">

			<p>
	要用 jeforth 在網頁上直接編輯的文章包括兩大部分：前一部分是一個 ID 為 "mystyle" 的 STYLE node：後一部分是一個名為 "myarticle" 的 DIV node，也就是像這樣的結構： &lt;style id=mystyle&gt; ... &lt;/style&gt; &lt;div id=myarticle&gt; ... &lt;/div&gt; 其他東西在 save 存檔時都會被忽略掉。雖然沒有 &lt;html&gt;, &lt;head&gt;, &lt;body&gt; 等常見的 Tag 但是所有的 Web browser 都可以打開它沒有問題。這樣做好處是方便拿這個檔案去別地方用 e.g. 把整個檔案讀進 jeforth 的網頁裡來進行編輯時，剪貼就好了，不必費力氣去清除多餘的部分。</p>

			<h2>研究怎麼存檔，分解動作</h2>

			<div>
<p>取得 style element</p>
<table class="commandline"><tbody><tr><td><code class="source">js&gt; mystyle.outerHTML .</code></td></tr></tbody></table>
</div><div><p>取得本文</p>
<table class="commandline"><tbody><tr><td><code class="source" id="tempid">js&gt; myarticle.outerHTML .</code></td></tr></tbody></table></div>

<p style='font: 20px/32px "Microsoft JhengHei"; color: rgb(0, 0, 0); text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; widows: 1; font-size-adjust: none; font-stretch: normal; background-color: rgb(240, 240, 240); -webkit-text-stroke-width: 0px;'>把兩個加起來存檔就可以草草成功了。因為要用到&nbsp;<span style="letter-spacing: 0px;">writeTextFile 所以必須要用 jeforth.3nw 或者 jeforth.3hta 另一個本來可能用的 jeforth.3htm 暫時還無法寫檔案。</span></p><table class="commandline"><tbody><tr><td>
<pre><code class="source">js&gt; mystyle.outerHTML+myarticle.outerHTML 
( 抓到 mystyle 跟 myarticle 加起來 ) pathname writeTextFile</code></pre>
</td></tr></tbody></table>


			<h2>研究怎麼讀檔案進來編輯，分解動作</h2>

			<p>
				先弄出一塊 DIV node 空間放在 jeforth 頁面 &lt;body&gt; 最下面，取名叫做 article：</p>

<table class="commandline"><tbody><tr><td><pre><code class="source">s" body" &lt;e&gt; &lt;div&gt;&lt;/div&gt;&lt;/e&gt; value article // ( -- element ) 整篇文章</code></pre></td></tr></tbody></table><p>然後把檔案讀進來取代這塊空間：</p><table class="commandline"><tbody><tr><td><pre><code class="source">pathname readTextFile article :: innerHTML=pop()</code></pre></td></tr></tbody></table><p style="color: rgb(0, 0, 0); text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; widows: 1; -webkit-text-stroke-width: 0px;">考慮若本來有 article 已經在頁面上則要先抹乾淨 (不是殺掉，怎麼殺？) 不要占用版面：</p>

<table class="commandline"><tbody><tr><td><pre><code class="source">article if article :: innerHTML="" then</code></pre></td></tr></tbody></table><p style="color: rgb(0, 0, 0); text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; widows: 1; -webkit-text-stroke-width: 0px;">article removeElement 是從 body 內把 article 移除，即使與 body 斷鏈&nbsp;article value 還是指向它，這就不會消失。新的 DIV 馬上會取代 article 但我仍覺得本來的要先清掉，杜絕浪費、隱患。</p><h3>完整的命令：</h3><p><span style="color: rgb(0, 0, 0); text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; widows: 1; -webkit-text-stroke-width: 0px;">run:&nbsp;' article if article :: innerHTML="" else<span class="Apple-converted-space">&nbsp;</span></span><span style="color: rgb(0, 0, 0); text-transform: none; text-indent: 0px; letter-spacing: 0px; word-spacing: 0px; white-space: normal; widows: 1; -webkit-text-stroke-width: 0px;">s" body" &lt;e&gt; &lt;div&gt;&lt;/div&gt;&lt;/e&gt; constant article then char playground/editor-study.html readTextFile article :: innerHTML=pop()</span></p><p><span style="color: rgb(0, 0, 0); text-transform: none; text-indent: 0px; letter-spacing: 0px; word-spacing: 0px; white-space: normal; widows: 1; -webkit-text-stroke-width: 0px;"></span>改變 node type 的辦法</p><p>1. 先 anchor&nbsp;在某個地方,&nbsp;Ctrl-F2 取得 anchorNode, 然後下命令。&nbsp; &lt;== 這個方案比較好。命令 change-to-code-style 已經成功。</p><p>2. 先下命令,&nbsp;然後到某個地方 click 一下。</p><p>href=#anchor 可以放在任何 TAG 嗎?</p><p>用上面第一個操作方法寫出來的命令，已經成功！</p><p>: change-to-code-style ( -- ) \ Change the ce@ to code style<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;o&gt; &lt;table class=commandline&gt;&lt;td&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;code id=tempid class=source&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/code&gt;&lt;/td&gt;&lt;/table&gt;&lt;/o&gt; ( from )<br> &nbsp; &nbsp; &nbsp; &nbsp;ce@ :&gt; nodeValue js: tempid.innerText=pop()<br> &nbsp; &nbsp; &nbsp; &nbsp;js: tempid.removeAttribute("id")<br> &nbsp; &nbsp; &nbsp; &nbsp;ce@ :&gt; parentNode replaceNode ;<br>kjhkkh</p><h3>變出一個 &lt;textarea&gt;直接編輯該element的outerHTML</h3><p>&lt;text&gt; js: confirm("檢查過確定抓到的東西沒錯？") if else stop then<br>\ 先檢查舊的 temptextarea 都先放掉<br>begin js&gt; document.getElementById("temptextarea") if js&gt; temptextarea dup :: removeAttribute("id") removeElement false else true then until<br>\ 把 target 的 outerHTML 抓進編輯區<br>ce@ :&gt; outerHTML &lt;o&gt; &lt;textarea id=temptextarea rows=8&gt;&lt;/textarea&gt;&lt;/o&gt; :: value=pop() &lt;/text&gt; (run:)<br></p><h3>生效編輯過的新 outerHTML</h3><p>ce@ :: outerHTML=temptextarea.value<br>js&gt; temptextarea dup :: removeAttribute("id") removeElement</p><p>&nbsp;</p>
			<table class="commandline"><tbody><tr><td class="code">
			<blockquote><pre><code class="source">
source code
</code></pre></blockquote></td></tr></tbody></table>

			<h2>Ending</h2>

			<p>
				ending
			</p>	
			<p>--- The End ---</p>	
			<p>H.C. Chen hcchen5600@gmail.com 2015.11.27</p>
			<p>FigTaiwan http://groups.google.com/group/figtaiwan</p>
		</blockquote></div>