<div>
<style id="mystyle" type="text/css" scoped="">
	.default { 
		font-family: Courier New;  
		letter-spacing: 0px;
		line-height: 160%;
		tab-size:4; 
	}
	
	code { 
		font-family: courier new;
		font-size: 110%; 
		background: #E0E0E0; 
	}
	
	.commandline { 
		width: 90%;
		background: #E0E0E0; 
	}
	.source {  
		font-size: 100%;   
		line-height: 120%; 
	}
</style><div class="default" id="myarticle"><span>[x] 這台電腦入睡之後會被無故喚醒，用 jeforth.3hta 來簡單解決。</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;馬上去睡, 萬一被無故喚醒之後 count down 30 秒後繼續睡，讓 user 有機會下 stop 停止。
</span><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><blockquote><table class="commandline"><tbody><tr><td><pre>[begin]<br>run shutdown /h<br>&lt;o&gt; Bringing the system into hibernate&lt;/o&gt; drop cr<br>&lt;o&gt; 3 wait 10 seconds .... "stop" me?&lt;/o&gt; drop cr 10000 nap<br>&lt;o&gt; 2 wait 10 seconds .... "stop" me?&lt;/o&gt; drop cr 10000 nap<br>&lt;o&gt; 1 wait 10 seconds .... "stop" me?&lt;/o&gt; drop cr 10000 nap<br>[again]</pre></td></tr></tbody></table></blockquote>
[x] 需要&nbsp;push outputbox 進 log.json [&lt;div&gt;,&lt;div&gt;,&lt;div&gt;...] 的機制. <br>&nbsp;&nbsp;&nbsp; log.push, log.pop, log 看全部。取代現有的 log.txt。<div>&nbsp;&nbsp;&nbsp; 已經完成!&nbsp;---&gt; editor.f<br>[x] 用得很多 js&gt; outputbox 何不把它變成一個 forth word? 因為本來有 outputbox 不必再浪費。<br>&nbsp;&nbsp;&nbsp; [ ] 既然如此 eleBody eleHead eleDisplay(shit! it IS outputbox) 都應該取消。一個<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 東西有兩個參考果然連自己都忘了，用最根本的就好了。<br>[x] 目前 edit open 是把文章放到 inputbox 下面，試改成放到 output box 上面。<br>[x] editbox 也要有 id=editboxtextarea。<br>[x] 先實驗 #text <strong>能</strong>不能用 editbox 編輯？outputbox 裡都是：<br>&nbsp;&nbsp;&nbsp; [x] so far, editbox does not correctly handle #text. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The 'node-source' command is not mature enough.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --&gt; 直接測試 node-source when ce@ is a #text --&gt; bug found!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --&gt; ce@ node-source \ ==&gt; 0: [object Text] (object) &lt;-- 果然不如預期，有 bug。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div></div></div></div><div><blockquote><table class="commandline"><tbody><tr><td>: node-source ( node -- "source" ) \ Get outerHTML or node.toString</td></tr></tbody></table>
&nbsp;&nbsp;&nbsp; --&gt; Ok now.</blockquote></div><p>[x] editbox-save 把所有東西都當 outerHTML 回存也不對, 至少就沒有照顧到 #text 假設可以。&nbsp;<br>&nbsp;&nbsp;&nbsp; : &nbsp;editbox-save ( -- ) \ ce@ is the target element.<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;js&gt; editboxtextarea.value  &lt;code&gt;escape&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<strong>ce@ dup :&gt; nodeValue if :: nodeValue=pop() else :: outerHTML=pop() then</strong> ;<br>&nbsp;&nbsp;&nbsp; --&gt; Yes, this way works. But we then can't change a #text to an <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; element neither&nbsp;vise versa. Because we are 沿用本來的 node or element.<br>&nbsp;&nbsp;&nbsp; --&gt; 所以要改成用替換的方式才行。</p></div></div></div><p>[x]&nbsp;save 應自動包括 log.save <br>[x] html5.f 裡的 replaceNode 用來把 #text 改成 &lt;p&gt; 有問題。<br>&nbsp;&nbsp;&nbsp; #text 本身就有 .replaceNode(newElement) 可用。<br>&nbsp;&nbsp;&nbsp; [x] 查一般 &lt;p&gt; &lt;table&gt; 等是否<strong>都有 .replaceNode()</strong> <strong>是</strong>的話 html5.f 要修正。<br>&nbsp;&nbsp;&nbsp; [x] html5.f 本來的 replaceNode 寫法用 replaceChild 有它的道理。一律都用 replaceNode 之後<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 只有 #text 正常，其他原來的 element 被 replaceNode 之後都跑到 newElement<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 所在之處的 outputbox 最下面來了。兩個方法要合併起來才對。當 target 有 outerHTML<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 時用原來的方法，沒有才直接用 replaceNode。<br>&nbsp;&nbsp;&nbsp; [x] 依上法恐怕 #text replace 成 element 還是會跑到 outputbox 最下面。哈! 不會, 成功了！<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 想必是因為 replaceNode 沒有把其他相關因素都 replace 過去。replaceNode 的資料有提到這點。<br>[x] 把 ctrl-F2 改成直接 edit 所在處的 node. 本來只是取得所在處的 node 進 ce@.&nbsp;<br>[x] 目前 editbox-save 會自動加 &lt;div&gt;...&lt;/div&gt; 為了保證所有的 editbox 內容都 replaceNode<br>&nbsp;&nbsp;&nbsp;&nbsp;原來的 node, but then there will be many redundent &lt;div&gt; ! So, don't do that.<br>&nbsp;&nbsp;&nbsp; It's user's responsibility to add their own &lt;div&gt;。<br>[x] Add border to outputbox when in contentEditable mode.<br>&nbsp;&nbsp;&nbsp; js&gt; outputbox :&gt; style &lt;js&gt; pop().border="thin solid red"&lt;/js&gt;<br>&nbsp;&nbsp;&nbsp; js&gt; outputbox :&gt; style &lt;js&gt; pop().border="thin solid white"&lt;/js&gt;<br>[x] Source code box 很難搞，應該是做出一個空的，讓 user 自己任意 copy-paste 東西進去。<br>&nbsp;&nbsp;&nbsp; ==&gt; 加強 [Example] 裡面多放點例子。<br>[x] 以下這個方法，後來發現不好。應該直接從 outputbox 往下 top-down 下來全部打框即可。<br>&nbsp;&nbsp;&nbsp; 【看清楚 outputbox 以下第一層 element 的範圍以免刪除時發生意外。】<br>&nbsp;&nbsp;&nbsp; 讓 double-click track back 到 outputbox 然後倒回來加上紅框，。<br>&nbsp;&nbsp;&nbsp; 手動做做看：</p></div></div></div></div></div><div><table class="commandline" style="margin-left: 2em;"><tbody><tr><td>js: body.ondblclick=function(){push(window.getSelection().anchorNode)}</td></tr></tbody></table></div><p>&nbsp;&nbsp; 這樣一行就成功了!而且直接 push()——不必用 kvm.push()。<br>&nbsp;&nbsp;&nbsp;#text 沒有 style 考慮把整段文字都用&nbsp;&lt;span style="border:thin solid red&gt; <br>&nbsp;&nbsp; 加框即可。有 style 的就用 border 本來有 border 的改過去不管它，因為是在 outputbox <br>&nbsp;&nbsp; 裡面無所謂。Released version should check if the forth handler&nbsp;existance<br>&nbsp;&nbsp; before&nbsp;hooking the event handler. So this is done after the definition of<br>&nbsp;&nbsp; the forth word.</p><div><table class="commandline" style="margin-left: 2em;"><tbody><tr><td><pre>&nbsp;\ 被 outputbox-high-light-toggle 取代了。這個 word 很有趣, double click 一個地方就會<br>&nbsp;\ 在 outputbox 之下把所屬的整個 element 用紅框圈起來。避免 {backSpace} 殺錯一整塊。<br>&nbsp;\ : mark-block ( node -- ) \ Add red border to the double clicked block under outputbox<br>&nbsp;\ &nbsp;begin ( node' )<br>&nbsp;\ &nbsp;&nbsp;dup :&gt; parentNode dup ( node' parent parent ) <br>&nbsp;\ &nbsp;&nbsp;js&gt; outputbox &lt;&gt; ( node' parent ? ) <br>&nbsp;\ &nbsp;while ( node' parent ) \ 不是 outputbox 還要再上升<br>&nbsp;\ &nbsp;&nbsp;nip ( parent )<br>&nbsp;\ &nbsp;( parent ) repeat ( node' parent )<br>&nbsp;\ &nbsp;drop ( node )<br>&nbsp;\ &nbsp;js&gt; tos().style if ( node )<br>&nbsp;\ &nbsp;&nbsp;&lt;js&gt; <br>&nbsp;\ &nbsp;&nbsp;if (tos().style.border=="thin solid red") pop().style.border="";<br>&nbsp;\ &nbsp;&nbsp;else pop().style.border="thin solid red";<br>&nbsp;\ &nbsp;&nbsp;&lt;/js&gt;<br>&nbsp;\ &nbsp;else ( node ) \ 沒有 style 的打賭是 #text <br>&nbsp;\ &nbsp;&nbsp;s' &lt;span style="border:thin solid red"&gt;' <br>&nbsp;\ &nbsp;&nbsp;js&gt; tos(1).nodeValue +<br>&nbsp;\ &nbsp;&nbsp;s' &lt;/span&gt;' + &lt;/o&gt; swap ( span node ) replaceNode<br>&nbsp;\ &nbsp;then ;</pre></td></tr></tbody></table></div><p>&nbsp;&nbsp;&nbsp; <span style="font: 0.8em/normal courier; font-size-adjust: none; font-stretch: normal;">js: body.ondblclick=function(){push(window.getSelection().anchorNode);execute("mark-block")} &lt;--- Bingo!!!</span><br>&nbsp;&nbsp;&nbsp; [x]&nbsp;這下麻煩了, 加了一堆紅框, 怎麼去除?&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==&gt; 當初打紅框上去時可以把原來的 .style.border 存在 ce@ 自己身上。</p><div><table class="commandline" style="margin-left: 2em;"><tbody><tr><td><pre>( node ) &lt;js&gt; <br><strong>tos().old_border = tos().style.border; &lt;---- Wow!!<br></strong>tos().style.border="thin solid red";<br>&lt;/js&gt; </pre></td></tr></tbody></table></div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ==&gt; Trace back to outputbox ... 方法有趣，但是不好。同樣目的應該 top-down 打框。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 清不掉的紅框，用 jquery 來清一次就算了。</p><div><table class="commandline" style="margin-left: 2em;"><tbody><tr><td><pre>js&gt; $("*").toArray()&nbsp;constant a \ 取得整個網頁的東西<br>true value debug \ debug 開關<br>&lt;text&gt;<br>a :&gt; length 1- for \ 不要忘記 1- !!!!<br>&nbsp; r@ <br>&nbsp; debug if *debug* 111&gt;&gt;&gt; then<br>&nbsp; a :&gt; [pop()] :&gt; style if<br>&nbsp;&nbsp;&nbsp; debug if *debug* 222&gt;&gt;&gt; then<br>&nbsp;&nbsp;&nbsp; r@ a :&gt; [pop()] &lt;js&gt; pop().style.border=="thin solid red"&lt;/jsV&gt; if<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; debug if *debug* 333&gt;&gt;&gt; then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r@ a :&gt; [pop()] :&gt; style.border=""<br>&nbsp;&nbsp;&nbsp; then<br>&nbsp; then<br>next<br>&lt;/text&gt; (run:)</pre></td></tr></tbody></table></div><p>&nbsp; &nbsp;[x] 【看清楚 outputbox 以下第一層 element 的範圍以免刪除時發生意外。】改用 top-down 方式。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; outputbox-high-light-toggle ok now.</p><p>[x] Autoit has {SLEE} key! Try it.<br>&nbsp;&nbsp;&nbsp; [x] Autoit has Sleep(mS) actually, it&nbsp;pauses Autoit script for mS of time, not<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bringing the system into sleep mode.&nbsp; </p><div><table class="commandline" style="margin-left: 2em;"><tbody><tr><td><pre>&gt; include autoit.f<br>&gt; au3 :: Sleep(500) \ ==&gt; No work!<br>&gt; au3 :: Sleepp(500)<br>JavaScript error : Object doesn't support property or method 'Sleepp'<br>&gt; au3 :: Sleep(5000) \ ==&gt; No work!</pre></td></tr></tbody></table></div><p>&nbsp;&nbsp;&nbsp;[x] au3 :: send('{!}') \ ==&gt; really sended a '1' right to the inputbox.<br>&nbsp;&nbsp;&nbsp;[!] au3 :: send('{SLEEP}') \ ==&gt;&nbsp;No work at all<br>&nbsp;&nbsp;&nbsp;[!] au3 :: send('{SLEEP}',1000) \ ==&gt; sended '{SLEEP}' to inputbox after 1 sec! 開玩笑嗎?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以上用&nbsp;autoit 自己的 SciTE-lite 實驗也是同樣的結果。<br>&nbsp;&nbsp;&nbsp;[x] au3 :: send('{VOLUME_MUTE}') \ ==&gt;&nbsp;It works! Toggled as anticipated.<br>&nbsp;&nbsp; [x] au3 :: Shutdown(32) it works! 32 is standby.<br>&nbsp;&nbsp; [x] improve hibernation.f , done. It standby now instead of hibernation.<br><br>[x] 進 editbox 順便要&nbsp;disable outputbox 的 contentEditable 否則會干擾 editbox 的使用。<br>&nbsp;&nbsp;&nbsp; --&gt; 現在發現進 editbox 時 outputbox 不一定要 contentEditable&nbsp;了 click 也可以(上面有提到)<br>&nbsp;&nbsp;&nbsp; --&gt; Double click == Ctrl-F2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>[/] 這行會觸動 ce@ 的防錯機制, ce@ 該擴充了。<br>&nbsp;&nbsp;&nbsp; article :&gt; currentStyle ce! ---&gt; 算了。<br>[x] 先插入一個&nbsp;anchor node 到所在處之 node 的前面 &lt;a id=editee&gt;&lt;/a&gt;. <br>&nbsp;&nbsp;&nbsp; 用來從 outputbox 中的 editor 跳回來。#text 有 insertBefore 嗎?怪就怪在它有，但是不能<br>&nbsp;&nbsp;&nbsp; 用，必須鑽到&nbsp;parent 下 insertBefore(newNode,me) 才行。答案是——可以。後來用 scrollTo() 不用 &lt;a&gt; 了。<br>[x] 不如直接把 editbox 就放到 target 下面 &lt;=== 餿主意,這樣會干擾原文,平添問題。還是放到 outputbox 最下面。<br>&nbsp;&nbsp;&nbsp;&nbsp;用 scrollTo() 來回 jump 只好如此。<br>

[x] editbox&nbsp;以及 Ctrl-F2/Double-click 要多一個 button [jump] 並且在 [save]、[close] 之後都自動跳回來。<br>&nbsp;&nbsp;&nbsp; [x] evernote 上剛才蒐集到一些 How to jump or scroll on a HTML page. .... see my Evernote.<br>&nbsp;&nbsp;&nbsp; 1. 取得 target node&nbsp;的 offset.top,&nbsp;#text 也有 offset. 其實就是 top 跟 left 之 integer 值。<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ce@ js&gt; $(pop()).offset() ( objOffset={top:int,left:int} )&nbsp;<br>&nbsp;&nbsp;&nbsp; 2. 用 window.scrollTo(offset.left, offset.top) 即可, 其中 left 固定用 0, top 是個 integer <br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 即 target node 的位置。 早就可以把它存起來。因為重點是 editbox 只出現在 outputbox 最下面所以不會<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 自己去干擾這個 top 值，重要！&lt;---- 好像相反了, <strong>top</strong> 似乎<strong>是從底下往上算的</strong>。觀察某個 element.offset().top 之值<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 的變化....<strong>果然是這樣</strong>。&nbsp;--&gt; 研究 jQuery&nbsp;除了 offset() 有沒有別的 option?&nbsp;因為是 window.scrollTo() 的 arg<br>&nbsp;&nbsp; 　　 所以沒轍。事先存好（絕對）位置不可行，只好在要 scrollTo 時臨時算出來，也就是事先存好該 node 的 object。<br>&nbsp;&nbsp;&nbsp; 3. 實驗時 ce@ 指在 target node (用 double click 取得) 然後：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;ce@ js&gt; $(pop()).offset() ( offset ) 1000 nap js: window.scrollTo(tos().left,tos().top) 10000 nap<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;這是因為從 inputbox 下令&nbsp;focus 會一直回到 inputbox 來而看不到 scroll 過去的效果，必續用時間延遲來克服。&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;[x] 從 target 跳回 editbox 可以用 id editboxeditarea 或 div-editbox 做到。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt; 5000 nap js&gt; $(editboxtextarea).offset().top js: window.scrollTo(0,pop())<br>&nbsp;&nbsp;&nbsp; [x] 當然跳回 target 就是:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt; 5000 nap ce@ js&gt; $(pop()).offset().top js: window.scrollTo(0,pop())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 但是跳不回 #text 只有&nbsp;element 可以。<br>&nbsp;&nbsp;&nbsp; [x] jump-to-ce@ defined in element.f 暫用 &lt;span&gt; 改裝 #text 終於成功了, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; editbox-save and -close are jumping back to ce@ now.</p><div>[x] Read a HTML file enclosed with &lt;body&gt;,&nbsp;give it to a element.innerHTML, </div><div>&nbsp;&nbsp;&nbsp; the &lt;body&gt; will be replaced by a &lt;div&gt; correctly in HTA. I believe all browsers are same.</div><div>--</div><div><div>[x] Sat Dec 19 09:48:11 UTC+0800 2015 </div><div><em>&nbsp;&nbsp;&nbsp; edit-node</em> should turn off oututbox contentEditable mode.</div><div>[x] Sat Dec 19 10:44:05 UTC+0800 2015 </div><div>&nbsp;&nbsp;&nbsp; <em>edit-node</em> needs to leverage ce so as for moving around&nbsp;among those nodes</div><div>&nbsp;&nbsp;&nbsp; --&gt; accept an input node but assign to ce! by itself.<br>--</div>[x] Sat Dec 19 09:40:35 UTC+0800 2015</div><div>&nbsp;&nbsp;&nbsp; Double-click to edit #text with &lt;O&gt;...&lt;/O&gt; causes strange results. --&gt; RI: jump-to-ce@ uses &lt;span&gt;<br>&nbsp;&nbsp;&nbsp; to convert a HTML block and convert back. During the process &lt;o&gt;..&lt;/o&gt; must be converted unexpectely<br>&nbsp;&nbsp;&nbsp; to an unKnownElement, or sometimes worse, being executed! That's what happened. Simply a <strike>&lt;o&gt;escape</strike><br>&nbsp;&nbsp;&nbsp; <strong>&lt;&gt;escpae</strong> command is needed&nbsp;<strong>before &lt;/o&gt;</strong> since we are sure it's a #text.<br>&nbsp;&nbsp;&nbsp; [x] &lt;o&gt;escape works fine now. But&nbsp;problem&nbsp;still happens at double-click to edit a node, after click<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [ok]&nbsp;to confirm&nbsp;the editing.&nbsp;So it's in the <em>content-handler</em>. --&gt; Ok before calling <em>edit</em>. So RI<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is in <em>edit</em>. So where in <em>edit</em>? --&gt; make a reDef&nbsp;edit to see that </div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --&gt; <em>edit-node ( node -- )</em> takes a given node now.... jump-to-ce@ fixed!</div><div>&nbsp;&nbsp;&nbsp; [x] Sun Dec 20 15:52:09 UTC+0800 2015&nbsp;&nbsp;But, things in editbox can be code with &lt;tags&gt; includes<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;e&gt; and &lt;o&gt; as #text while can also be really HTML &lt;tags&gt;. Only the user knows what are<br><code></code><code></code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; they. So <strike>[Save as HTML] [Save as #text] needed.</strike> No! <strong>that's exactly what &lt;code&gt; is for!!!</strong> <br>[x] Sat Dec 19 14:06:48 UTC+0800 2015 jsc new command: "reset" or {ESC} and "g" to continue</div><div>[x] editbox 還有問題。整個結果必須是 one new node replace the old node. 事實上連我都會忘記, 而弄成 multiple node</div></div><div><div>&nbsp;&nbsp;&nbsp; 要去 replace the old node. 結果只有 last new node replace 過去, 其他的都掉到 outputbox 最底下。解法是：</div><div>&nbsp;&nbsp;&nbsp; ---&gt; make an enveloped group of nodes &lt;o&gt; &lt;span&gt; aa &lt;b&gt;bb&lt;/b&gt; &lt;i&gt;cc&lt;/i&gt; dd&lt;/span&gt;&lt;/o&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The outer &lt;span&gt; is intentionally added by editbox. Can't be &lt;div&gt;, it breaks an unexpected&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new line in browser.</div><div>&nbsp;&nbsp;&nbsp;先包成 &lt;span&gt;editboxtextarea&lt;/span&gt; 完成 one new node replace the old node 然後把 new node unenvelope 即可。<br>&nbsp;&nbsp; 修改 editor.f ... 成功了!!!!</div><div>&nbsp;</div><div>[x] Sat Dec 19 09:34:59 UTC+0800 2015<div>&nbsp;&nbsp;&nbsp; now, to study editbox bugs, my single-click is even more strange. It was supposed to get the node but </div><div>&nbsp;&nbsp;&nbsp; now [enter], [f9], [f10], and more are also generating single-click !!! why? --&gt; Root cause partially</div><div>&nbsp;&nbsp; &nbsp;identified: Hook onclick() on body causes that symptom tht {enter},{F9}, and some other hotkeys are also</div><div>&nbsp;&nbsp; &nbsp;generating body.onclick() event. --&gt; if <strong>hook it on only outputbox resolves that symptom</strong>. But ctrl-click </div><div>&nbsp;&nbsp;&nbsp; still marks the entire element which is the outputbox here. That happenes before onclick() gets the </div><div>&nbsp;&nbsp;&nbsp; control. So, <strong>use shift-click or alt-click instead</strong> is an optional solution. By the way, this</div><div>&nbsp;&nbsp;&nbsp; article&nbsp;<a href="http://stackoverflow.com/questions/18316509/detect-ctrl-and-shift-key-without-keydown-event">http://stackoverflow.com/questions/18316509/detect-ctrl-and-shift-key-without-keydown-event</a>&nbsp;</div><div>&nbsp;&nbsp;&nbsp; indicates that during onclick()&nbsp;the e.shiftKey, e.altKey, and e.ctrlKey status are available, don't </div><div>&nbsp;&nbsp;&nbsp; worry if you do.</div></div><div>[x] &lt;iframe&gt;這裡幹嘛?&lt;/iframe&gt;</div><blockquote>&lt;o&gt; <br>&lt;iframe src="playground/test.html"&gt;<br>這裡是給不認得 iframe 的 browser 用的替代文字,這是 HTML 的通例<br>&lt;/iframe&gt;<br>&lt;/o&gt; </blockquote><blockquote>實驗看看：<blockquote>&gt; &lt;o&gt; &lt;abc&gt; what will me be?&lt;/abc&gt;&lt;/o&gt;<br>&nbsp;what will me be? OK <br>&gt; ce<br>[object HTMLUnknownElement] innerHTML= what will me be?...<br>&nbsp;0 : [object Text]&nbsp; what will me be?...<br>&gt; obj&gt;keys . </blockquote></blockquote><blockquote>連隨便亂寫的 [object HTMLUnknownElement] 都有這些 properties：<br>recordset,namedRecordset,currentStyle,runtimeStyle,accessKey,all,behaviorUrns,<br>canHaveChildren,canHaveHTML,children,className,contentEditable,dir,disabled,<br>document,filters,hideFocus,id,innerHTML,innerText,isContentEditable,isDisabled,<br>isMultiLine,isTextEdit,lang,language,offsetHeight,offsetLeft,offsetParent,offsetTop,<br>offsetWidth,onabort,onactivate,onafterupdate,onbeforeactivate,onbeforecopy,onbeforecut,<br>onbeforedeactivate ... snip ...</blockquote><div>[x]&nbsp;To make an iframe contentEditable,&nbsp;</div><div>&nbsp;&nbsp;&nbsp; 0: [object HTMLIFrameElement] (object) &gt; dup :&gt; contentEditable="true" &lt;=== It does not work. </div><div>&nbsp;&nbsp;&nbsp; Incorrect object for the purpose. Should do it through:</div><div>&nbsp;&nbsp;&nbsp; myiframe :&gt; contentDocument . \ ==&gt; [object HTMLDocument] OK <br>&nbsp;&nbsp;&nbsp; &gt; myiframe :&gt; contentDocument.body.contentEditable="true" .<br></div><div>[x] Possible useful properties of an iframe object:</div><div>&nbsp;&nbsp;&nbsp; sandbox,allowFullscreen,width,height,contentDocument,</div><div>&nbsp;&nbsp;&nbsp; contentWindow,scrolling,frameBorder,title,contentEditable,onchange,<br></div><div>[x] Through jQuery, this is the cross browser common way to get the document of the iframe.</div><p>&nbsp;&nbsp;&nbsp; 照以下這樣取得的 iframe id 在 HTA, Chrome 意義不一樣。</p><table class="commandline" style="margin-left: 2em;"><tbody><tr><td>&lt;o&gt; <br>&lt;div align=center&gt;<br>&lt;h1&gt;log.html&lt;/h1&gt;<br>&lt;iframe id=<strong>outputboxlog</strong> width=100%&gt;&lt;/iframe&gt;<br>&lt;/div&gt;<br>&lt;/o&gt; js&gt; outputbox insertBefore</td></tr></tbody></table><blockquote><p><strong>--- HTA ---<br></strong>&gt; js&gt; outputboxlog .&nbsp; <br>[object Window] OK&nbsp; &lt;------------------- HTA 認為 iframe 就是 window<br>&gt; js&gt; outputboxlog.document . &lt;--------- 故直接用 .document access<br>[object Document] OK <br>&gt; js&gt; outputboxlog.contentDocument . &lt;---- Doesn't know !!<br>undefined OK </p><p><strong>--- Chrome ---</strong><br>&gt; js&gt; outputboxlog .<br>[object HTMLIFrameElement] OK&nbsp; &lt;------- Chrome 認為 iframe 就是 iframe<br>&gt; js&gt; outputboxlog.document . <br>undefined OK&nbsp; &lt;------ Chrome doesn't think iframe is a window<br>&gt; js&gt; outputboxlog.<strong>contentDocument</strong> . &lt;--- 故另有 property access document<br>[object HTMLDocument] OK </p><p>既然如此,只好祭出 jQuery 來統一用法。<br><a href="http://stackoverflow.com/questions/364952/jquery-javascript-accessing-contents-of-an-iframe">http://stackoverflow.com/questions/364952/jquery-javascript-accessing-contents-of-an-iframe</a></p><p>&gt; ce 看清楚 ce 是咱的整塊 iframe 以及周邊<br>[object HTMLDivElement] innerHTML=&lt;h1&gt;log.htmml&lt;/h1&gt;&lt;iframe width="100%" id="outputboxlog"&gt;&lt;/iframe&gt;...<br>&nbsp;&nbsp;&nbsp; 0 : [object HTMLHeadingElement] innerHTML=log.json...<br>&nbsp;&nbsp;&nbsp; 1 : [object HTMLIFrameElement] id='outputboxlog'; <br>&gt; ce@ :&gt; lastChild ( 就是 outputboxlog the iframe ) js&gt; $(pop()).contents() .&nbsp;<strong> </strong><br>[object Object] OK <strong>&lt;=== get iframe's jQuery contents()</strong><br>&gt; ce@ :&gt; lastChild js&gt; $(pop()).contents().length . &lt;=== iframe's conents() has only one thing<br>1 OK <br>&gt; ce@ :&gt; lastChild js&gt; $(pop()).contents()[0] .&nbsp; <br>[object Document] OK <strong>&lt;== which is its document object</strong><br>So, <strong>both HTA's window and Chrome's contentDocument are of iframe's contents()</strong>.&nbsp;</p><p>------------- 使用 iframe 的總整理 ---------------------<br>&lt;o&gt; <br>&lt;div align=center&gt;<br>&lt;h1&gt;log.json&lt;/h1&gt;<br>&lt;iframe width=100%&gt;&lt;/iframe&gt;&lt;/div&gt;<br>&lt;/o&gt; value log-div // ( -- eleDiv ) The log editing area.<br><strong>log-div ce! er ( 把 element 中的多餘 #text 清掉,好手法 )</strong> ce@ js&gt; outputbox insertBefore <br>&nbsp;&gt; log-div :&gt; lastChild .<br>[object HTMLIFrameElement]<br>&gt; log-div :&gt; firstChild .<br>[object HTMLHeadingElement]<br>log-div :&gt; lastChild js&gt; $(pop()).contents()[0] value log-document<br>&gt; log-document :&gt; body.innerHTML="&lt;h1&gt;hello&lt;/h1&gt;"<br>&gt; log-document :&gt; body .<br>[object HTMLBodyElement] OK <br>&gt; log-document :&gt; body ce!<br>&gt; ce<br>[object HTMLBodyElement] innerHTML=&lt;h1&gt;hello&lt;/h1&gt;...<br>&nbsp;&nbsp;&nbsp; 0 : [object HTMLHeadingElement] innerHTML=hello...<br>&gt; ce@ :&gt; outerHTML .<br>&lt;body&gt;&lt;h1&gt;hello&lt;/h1&gt;&lt;/body&gt;</p></blockquote>[x] if editing area is in the jeforth then any id that conficts <br>&nbsp;&nbsp;&nbsp; with jeforth variable can crash the entire system. --&gt; Alouth that can happen, iframe <br>&nbsp;&nbsp;&nbsp; is long term. Use jeforth &lt;body&gt; is really very convenient.<br>--<br>[ ] Outputbox log 的 &lt;div&gt; 越套越多層,如果要解決可以考慮從裡面加套一個有 id 的 &lt;div&gt; 然後只 log.push 這個 &lt;div&gt;。<br>[ ] env@ 只有 3hta 能用, 致使 editor.f 在 3nw 暫時還不能用。<br>&nbsp;&nbsp;&nbsp; 其實 3nw 也可以 access environment variables.<br>[ ]&nbsp;這個好用! <strong>article :&gt; style :: backgroundColor="white"</strong>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;[ ]&nbsp;Canvas.f 裡面我為了改 style 所用的方法很笨。<br>&nbsp;&nbsp;&nbsp; [ ]&nbsp;index.html, jeforth.htm,&nbsp;jeforth.3nw.html 好像都很笨。<br>&nbsp;&nbsp;&nbsp; [ ] &lt;div style="margin-left: <strong>2em</strong>;"&gt;OK&lt;/div&gt; \ <strong>em 是當時 font-size 的倍數，可正負&amp;小數</strong>。<table class="commandline" style="margin-left: 2em;"><tbody><tr><td>&gt; ce@ :&gt; style :&gt; fontSize . \ ==&gt; 10px OK<br>&gt; ce@ :&gt; style :&gt; getPropertyValue("font-size") . \ ==&gt; 10px OK<br>&gt; ce@ :&gt; style :&gt; fontSize=""<br>&gt; ce@ :&gt; style :&gt; getPropertyValue("font-size") . \ ==&gt; ""</td></tr></tbody></table>
[ ] unindent.f should be merged to html5.f. also element.f and canvas.f ... maybe someday.<div><div>[ ] Use iframe for article, log, and more separatedly.<br>&nbsp;&nbsp;&nbsp; 幾乎所有的 iframe attributes do not work on HTA but work fine on Chrome. See w3schools regarding iframe,<br>&nbsp;&nbsp;&nbsp; HTML5 actually droped many of them. Note, Can be width=100% or width=100 (pixels); but can only be<br>&nbsp;&nbsp;&nbsp; height=500 (pixels) no height=80%, no. Align does not work, so my workaround is to use a &lt;div&gt; to<br>&nbsp;&nbsp;&nbsp; align.</div><div>[ ] open multiple articles. </div></div><div>[ ] Open/Save 之後，即有東西在 editing 時，在 inputbox 下面列出該檔案的 pathname 以資提示。<br>[ ] open / save should be bottons for each edited file. --&gt; Open, Save, Move up, Move down, pathname.</div><div>--</div><div>[ ] the outer &lt;div id=myarticle&gt; should be modified to id=&lt;edit-list-id&gt;, while edit-list is a hash table or simply an array&nbsp;to store all the files. Each file has a pathname, edit-list-id, but share the same style seems to be a must as far I feel.</div><div>{}&nbsp;value edit-list // ( -- array ) jeforth HTML editor can edit multiple files at the same time.</div><div>--</div><div><div>[x] Expariment of how to onclick --</div><div><div><table class="commandline" style="margin-left: 2em;"><tbody><tr><td><pre><code class="source">: edit-zone-save . ;<br></code><code class="source">[No]&nbsp; &lt;o&gt; &lt;input type=button value=Save onclick=function(){push(123);kvm.execute('edit-zone-save')} /&gt;&lt;/o&gt;<br>[No]&nbsp; &lt;o&gt; &lt;input type=button value=Save onclick="function(){push(123);kvm.execute('edit-zone-save')}" /&gt;&lt;/o&gt;<br>[No]&nbsp; &lt;o&gt; &lt;input type=button value=Save onclick="function(){push(123)}" /&gt;&lt;/o&gt;<br>[No]&nbsp; &lt;o&gt; &lt;input type=button value=Save onclick=function(){} /&gt;&lt;/o&gt;<br>[Yes] &lt;o&gt; &lt;input type=button value=Save /&gt;&lt;/o&gt;<br>[No]&nbsp; &lt;o&gt; &lt;input type=button value=Save onclick="push(123)" /&gt;&lt;/o&gt;<br>[Yes] &lt;o&gt; &lt;input type=button value=Save onclick="vm.push(123);vm.execute('edit-zone-save')" /&gt;&lt;/o&gt;</code></pre></td></tr></tbody></table></div><div>--<br>[x] design the edit zone first of all. The first challenge is how to distinguish&nbsp;<br>&nbsp;&nbsp;&nbsp; where was each button event from? Use the&nbsp;.replace(/_id_/,pop()) technique.</div><div>&nbsp;&nbsp;&nbsp; ==&gt; Now <em>open</em> is using <em>edit-zone</em>. <br>--</div></div></div><div>[x] Sun Dec 20 11:35:15 UTC+0800 2015<br>&nbsp;&nbsp;&nbsp; after editbox cr's in &lt;pre&gt;&lt;/pre&gt; are removed. Why? I removed the very important &lt;code&gt;..&lt;/code&gt;<br>&nbsp;&nbsp;&nbsp; that's why I guess.</div><div>--</div><div>[x] Sun Dec 20 16:58:41 UTC+0800 2015 </div><div>&nbsp;&nbsp;&nbsp; When editbox is active, disable double-click. Double-click check div-editbox.</div><div>--</div><div><div>[x] Mon Dec 21 16:19:16 UTC+0800 2015 <br>&nbsp;&nbsp;&nbsp; [Save][Close] ... buttons should be also under&nbsp;each edit-zone.</div><div>--</div>[ ] Sun Dec 20 17:25:44 UTC+0800 2015 <br>&nbsp;&nbsp;&nbsp; How to separate different CSS style for each&nbsp;&lt;DIV&gt; ?<br>&nbsp;&nbsp;&nbsp; <a href="https://css-tricks.com/saving-the-day-with-scoped-css/">https://css-tricks.com/saving-the-day-with-scoped-css/</a><br><table class="commandline" style="margin-left: 2em;"><tbody><tr><td><pre><code class="source">&lt;div&gt;
  &lt;style scoped&gt;  <strong>&lt;=== No browser support, 2015. Forget it.</strong> 
    h1 { color: FireBrick;   }
    p  { color: SaddleBrown; }
  &lt;/style&gt;
  &lt;h1&gt;This is an H1 in a scoped div. Regardless of global styles the text should be "FireBrick".&lt;/h1&gt;
  &lt;p&gt;This is a paragraph in a scoped div. The text should be "SaddleBrown".&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;This is another paragraph, that will unaffected by the scoped style and remain black.&lt;/p&gt;    </code></pre></td></tr></tbody></table> 
</div><div>&nbsp;&nbsp;&nbsp; Also <a href="http://www.webhek.com/scoped-css">http://www.webhek.com/scoped-css</a>&nbsp;</div><div>
</div><div>&nbsp;&nbsp;&nbsp; Bad news in 2012 <a href="http://www.impressivewebs.com/scoped-styles-html5/">http://www.impressivewebs.com/scoped-styles-html5/</a>&nbsp;No browser support <em>scoped</em>.<br>&nbsp;&nbsp;&nbsp; ==&gt; <strong>Forget it</strong>. <br>----------------------------------------------------------<br>&nbsp;&nbsp;&nbsp; [x] Study the formal way. --&gt; The below example should be good enough. And I realized why the <em>scoped</em> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; has not get the priority till now. Not necessary! -- Mon Dec 21 18:32:54 UTC+0800 2015 <br><table class="commandline" style="margin-left: 2em;"><tbody><tr><td><pre><code class="source">&lt;o&gt;&lt;div&gt;<br>&lt;div class=green&gt;<br>&nbsp;&nbsp;&nbsp; &lt;style&gt; /* 各自寫自己的 style section */<br>&nbsp;&nbsp;&nbsp; .green { color: green;} /* .green 只放最外圍一個 &lt;DIV&gt; 就夠了, for everything in it */<br>&nbsp;&nbsp;&nbsp; .green .asize {font-size:2em;} /* only for .asize in .green&nbsp; */<br>&nbsp;&nbsp;&nbsp; .green .bsize {font-size:0.8em;} /* 若寫成 .green * 或 .green p, .green h3, ... 就想太多了 */<br>&nbsp;&nbsp;&nbsp; &lt;/style&gt;<br>&nbsp;&nbsp;&nbsp; &lt;h3&gt; I am a H3 tag&lt;/h3&gt;<br>&nbsp;&nbsp;&nbsp; &lt;p class=asize&gt; I am a P tag of green and A-size&lt;/p&gt;<br>&nbsp;&nbsp;&nbsp; &lt;b class=bsize&gt; bold &lt;i&gt;italiy&lt;/i&gt; sdfsdfsdf B-size in the entire B tab &lt;/b&gt;&lt;br&gt;<br>&nbsp;&nbsp;&nbsp; &lt;span class=bsize&gt; bold &lt;i&gt;italiy&lt;/i&gt; sdfsdfsdf B-size in the entire SPAN tag &lt;/span&gt;&lt;br&gt;<br>&nbsp;&nbsp;&nbsp; &lt;span&gt; bold &lt;i&gt;italiy&lt;/i&gt; sdfsdfsdf B-size in the entire SPAN tag &lt;/span&gt;&lt;br&gt;<br>&lt;/div&gt;</code></pre><pre><code class="source">&lt;div class=blue&gt;<br>&nbsp;&nbsp;&nbsp; &lt;style&gt;&nbsp; /* 各自寫自己的 style section */<br>&nbsp;&nbsp;&nbsp; .blue { color: blue;} /* 不能多寫, 多寫範圍越窄 */<br>&nbsp;&nbsp;&nbsp; .blue .asize {font-size:0.8em;}<br>&nbsp;&nbsp;&nbsp; .blue .bsize {font-size:2em;}<br>&nbsp;&nbsp;&nbsp; &lt;/style&gt;<br>&nbsp;&nbsp;&nbsp; &lt;h3&gt; I am a H3 tag&lt;/h3&gt;<br>&nbsp;&nbsp;&nbsp; &lt;p class=asize&gt; I am blue P tag A-size&lt;/p&gt;<br>&nbsp;&nbsp;&nbsp; &lt;b class=bsize&gt; bold &lt;i&gt;italiy&lt;/i&gt; sdfsdfsdf B tag with B-size&lt;/b&gt;&lt;br&gt;<br>&nbsp;&nbsp;&nbsp; &lt;span class=bsize&gt; bold &lt;i&gt;italiy&lt;/i&gt; sdfsdfsdf B-size in the entire SPAN tag &lt;/span&gt;&lt;br&gt;<br>&nbsp;&nbsp;&nbsp; &lt;span&gt; bold &lt;i&gt;italiy&lt;/i&gt; sdfsdfsdf B-size in the entire SPAN tag &lt;/span&gt;&lt;br&gt;<br>&lt;/div&gt;<br>&lt;/div&gt;&lt;/o&gt;<br></code></pre></td></tr></tbody></table>
</div><div>
</div><blockquote><div style="border: 1px solid black;">
<div class="green">
    <style> /* 各自寫自己的 style section */
    .green { color: green;} /* .green 只放最外圍一個 <DIV> 就夠了, for everything in it */
    .green .asize {font-size:2em;} /* only for .asize in .green  */
    .green .bsize {font-size:0.8em;} /* 若寫成 .green * 或 .green p, .green h3, ... 就想太多了 */
    </style>
    <h3> I am a H3 tag</h3>
    <p class="asize"> I am a P tag of green and A-size</p>
    <b class="bsize"> bold <i>italiy</i> sdfsdfsdf B-size in the entire B tab </b><br>
    <span class="bsize"> bold <i>italiy</i> sdfsdfsdf B-size in the entire SPAN tag </span><br>
    <span> bold <i>italiy</i> sdfsdfsdf B-size in the entire SPAN tag </span><br>
</div>
<div class="blue">
    <style>  /* 各自寫自己的 style section */
    .blue { color: blue;}
    .blue .asize {font-size:0.8em;}
    .blue .bsize {font-size:2em;}
    </style>
    <h3> I am a H3 tag</h3>
    <p class="asize"> I am blue P tag A-size</p>
    <b class="bsize"> bold <i>italiy</i> sdfsdfsdf B tag with B-size</b><br>
    <span class="bsize"> bold <i>italiy</i> sdfsdfsdf B-size in the entire SPAN tag </span><br>
    <span> bold <i>italiy</i> sdfsdfsdf B-size in the entire SPAN tag </span><br>
</div>
</div></blockquote><div>
--
</div><div>--
</div><div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div><div>-- </div>--
</div></div></div></div></div></div></div>